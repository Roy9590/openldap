##
## Makefile.in for ldapd
##
PROGRAMS=ldapd
XPROGRAMS=sldapd

SRCS	= main.c request.c bind.c result.c error.c \
	search.c util.c compare.c message.c add.c delete.c modrdn.c modify.c \
	abandon.c syntax.c association.c kerberos.c certificate.c
OBJS	= main.o request.o bind.o result.o error.o \
	search.o util.o compare.o message.o add.o delete.o modrdn.o modify.o \
	abandon.o syntax.o association.o kerberos.o LDAP_tables.o \
	certificate.o

LDAP_INCDIR= ../../include       
LDAP_LIBDIR= ../../libraries

BUILD_OPT = "--enable-ldapd"
BUILD_SRV = @BUILD_LDAPD@

XLIBS= $(LDAPD_LIBS) $(KRB_LIBS) $(LUTIL_LIBS)

ldapd:	version.o
	$(LDLINK) -o $@ $(OBJS) version.o $(LIBS)

sldapd:	version.o
	$(LDLINK) -static -o $@ $(OBJS) version.o $(LDFLAGS) $(LIBS) -lresolv

version.c: $(OBJS) $(LDAP_LIBDIR)/liblber/liblber.a
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	 t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	-e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	-e "s|%VERSION%|$${v}|" \
	< $(srcdir)/Version.c > $@)

request.o:	LDAP-types.h

LDAP_tables.c:	ldap.py
	@if [ ! -z "$(PEPSY)" ]; then \
	    $(PEPSY) -A ldap.py; \
	else \
	    touch LDAP_tables.c LDAP-types.h; \
	fi

LDAP-types.h: LDAP_tables.c

install-local-srv: FORCE
	@$(MKDIR) $(libexecdir)
	$(LTINSTALL) $(INSTALLFLAGS) -m 755 ldapd $(LDAP_LIBEXECDIR)
