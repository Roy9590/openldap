# $OpenLDAP$
##
## Makefile.in for ldapd
##
PROGRAMS=ldapd
XPROGRAMS=sldapd

XSRCS	= version.c

SRCS	= main.c request.c bind.c result.c error.c \
	search.c util.c compare.c message.c add.c delete.c modrdn.c modify.c \
	abandon.c syntax.c association.c kerberos.c certificate.c
OBJS	= main.o request.o bind.o result.o error.o \
	search.o util.o compare.o message.o add.o delete.o modrdn.o modify.o \
	abandon.o syntax.o association.o kerberos.o LDAP_tables.o \
	certificate.o

LDAP_INCDIR= ../../include       
LDAP_LIBDIR= ../../libraries

BUILD_OPT = "--enable-ldapd"
BUILD_SRV = @BUILD_LDAPD@

all-local-srv: 	ldapd

XLIBS= -llber -llutil
XXLIBS= $(LDAPD_LIBS) $(SECURITY_LIBS) $(LUTIL_LIBS)

ldapd:	version.o
	$(LTLINK) -o $@ $(OBJS) version.o $(LIBS)

sldapd:	version.o
	$(LTLINK) -static -o $@ $(OBJS) version.o $(LIBS)

version.c: $(OBJS) $(LDAP_LIBLBER_DEPEND)
	$(RM) $@
	$(MKVERSION) ldapd > $@

request.o:	LDAP-types.h

LDAP_tables.c:	ldap.py
	@if [ ! -z "$(PEPSY)" ]; then \
	    $(PEPSY) -A ldap.py; \
	else \
	    touch LDAP_tables.c LDAP-types.h; \
	fi

LDAP-types.h: LDAP_tables.c

install-local-srv: FORCE
	-$(MKDIR) $(DESTDIR)$(libexecdir)
	$(LTINSTALL) $(INSTALLFLAGS) -s -m 755 ldapd $(DESTDIR)$(libexecdir)
