PROGRAMS= rp500 fax500

SRCS= main.c faxtotpc.c rp500.c
XSRCS=fax5version.c rpversion.c

FAX5OBJS = main.o faxtotpc.o
RPOBJS =  rp500.o faxtotpc.o

LDAP_INCDIR= ../../include
LDAP_LIBDIR= ../../libraries

rp500 : rpversion.o
	$(LTLINK) -o $@ $(RPOBJS) rpversion.o $(LIBS)

fax500 : fax5version.o
	$(LTLINK) -o $@ $(RPOBJS) fax5version.o $(LIBS)

rpversion.c: ${RPOBJS} $(LDAP_LIBDEPEND)
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	    t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	    -e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	    -e "s|%VERSION%|$${v}|" \
	    < $(srcdir)/Versionrp.c > $@)

fax5version.c: ${FAX5OBJS} $(LDAP_LIBDEPEND)
	$(RM) $@
	(u=$${USER-root} v=`$(CAT) $(VERSIONFILE)` d=`$(PWD)` h=`$(HOSTNAME)` \
	    t=`$(DATE)`; $(SED) -e "s|%WHEN%|$${t}|" \
	    -e "s|%WHOANDWHERE%|$${u}@$${h}:$${d}|" \
	    -e "s|%VERSION%|$${v}|" \
	    < $(srcdir)/Version.c > $@)

install-local: $(PROGRAMS) xrpcomp FORCE
	-$(MKDIR) -p $(libexecdir)
	$(LTINSTALL) $(INSTALLFLAGS) -m 755 rp500 $(libexecdir)
	$(LTINSTALL) $(INSTALLFLAGS) -m 755 fax500 $(libexecdir)
	$(SED) -e 's%LIBEXECDIR%$(libexecdir)%' $(srcdir)/xrpcomp > /tmp/xrpcomp.tmp
	$(INSTALL) $(INSTALLFLAGS) -m 755 /tmp/xrpcomp.tmp $(libexecdir)/xrpcomp
	$(RM) /tmp/xrpcomp.tmp
