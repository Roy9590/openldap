#! /bin/sh
## Copyright 1998,1999 The OpenLDAP Foundation
## COPYING RESTRICTIONS APPLY.  See COPYRIGHT File in top level directory
## of this package for details.
#
# Make a release
#	mkrelease RELNAME CVSTAG CVSMODULES
# where CVSTAG is the tag to export from the current CVSROOT
#

set -e 		# exit immediately if any errors occur

if test $# != 3 ; then
	echo 'usage: mkrelease RELNAME CVSTAG CVSMODULES ...'
	exit 1
fi

RELNAME=opendlap-$1
shift
CVSTAG=$1
shift

if test -e $RELNAME ; then
	echo "error: $RELNAME exists"
	exit 1
fi

cvs export -r$CVSTAG -d $RELNAME $*

if test ! -d $RELNAME ; then
	echo "error: $RELNAME doesn't exists"
	exit 1
fi

if test ! -e $RELNAME/build/version ; then
	echo "No build version"
	exit 1
fi

tar cf $RELNAME.tar $RELNAME
gzip -9 -c $RELNAME.tar > $RELNAME.tgz
md5 $RELNAME.tgz > $RELNAME.md5

ls -l $RELNAME.*
cat $RELNAME/build/version
