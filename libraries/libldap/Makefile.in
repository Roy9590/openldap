##
## Makefile.in for LDAP -lldap
##
LIBRARY = libldap.a
PROGRAMS = apitest ltest ttest

LDAP_INCDIR= ../../include       
LDAP_LIBDIR= ../../libraries


SRCS	= bind.c open.c result.c error.c compare.c search.c \
	modify.c add.c modrdn.c delete.c abandon.c ufn.c cache.c \
	getfilter.c sbind.c kbind.c unbind.c friendly.c cldap.c \
	free.c disptmpl.c srchpref.c dsparse.c tmplout.c sort.c \
	getdn.c getentry.c getattr.c getvalues.c addentry.c \
	request.c getdxbyname.c os-ip.c url.c charset.c \
	init.c options.c
OBJS	= bind.o open.o result.o error.o compare.o search.o \
	modify.o add.o modrdn.o delete.o abandon.o ufn.o cache.o \
	getfilter.o sbind.o kbind.o unbind.o friendly.o cldap.o \
	free.o disptmpl.o srchpref.o dsparse.o tmplout.o sort.o \
	getdn.o getentry.o getattr.o getvalues.o addentry.o \
	request.o getdxbyname.o os-ip.o url.o charset.o \
	init.o options.o

LIBS = -L$(LDAP_LIBDIR) -lldap -llber $(AC_LIBS)
LIBLBER = ../liblber/liblber.a

apitest:	$(LIBRARY) apitest.o $(LIBLBER)
	$(CC) $(LDFLAGS) -o $@ apitest.o $(LIBS)
ltest:	$(LIBRARY) test.o $(LIBLBER)
	$(CC) $(LDFLAGS) -o $@ test.o $(LIBS)
ttest:	$(LIBRARY) tmpltest.o $(LIBLBER)
	$(CC) $(LDFLAGS) -o $@ tmpltest.o $(LIBS)

CFFILES= ldap.conf ldapfilter.conf ldapfriendly ldaptemplates.conf ldapsearchprefs.conf

install-local: $(LIBRARY) $(CFFILES) FORCE
	-$(MKDIR) -p $(libdir)
	$(INSTALL) $(INSTALLFLAGS) -m 644 $(LIBRARY) $(libdir)
	@(cd /tmp; $(RANLIB) $(libdir)/$(LIBRARY))
	-$(MKDIR) -p $(sysconfdir)
	@for i in $(CFFILES); do \
		echo "installing $$i in $(sysconfdir)"; \
		if test -f $(sysconfdir)/$$i; then \
			$(MV) $(sysconfdir)/$$i $(sysconfdir)/$$i-; \
		fi; \
		$(INSTALL) $(INSTALLFLAGS) -m 644 $$i $(sysconfdir); \
	done
