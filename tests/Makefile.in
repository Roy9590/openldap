## Copyright 1998 The OpenLDAP Foundation, All Rights Reserved.
## COPYING RESTRICTIONS APPLY, see COPYRIGHT file
##
## tests Makefile.in for OpenLDAP
BUILD_BDB2 = @BUILD_BDB2@

SRC      = slapd-tester.c slapd-search.c
PROGRAMS = slapd-tester slapd-search slapd-read slapd-addel

LDAP_INCDIR= ../include
LDAP_LIBDIR= ../libraries

XLIBS    = -lldap_r -llber -llutil

build-tools: FORCE
	$(MAKE) $(MFLAGS) load-tools

load-tools: $(PROGRAMS)

slapd-tester: slapd-tester.o 
	$(LTLINK) -o $@ slapd-tester.o

slapd-search: slapd-search.o $(LDAP_LIBLBER_DEPEND) $(LDAP_LIBLDAP_DEPEND)
	$(LTLINK) -o $@ slapd-search.o $(LIBS)

slapd-read: slapd-read.o $(LDAP_LIBLBER_DEPEND) $(LDAP_LIBLDAP_DEPEND)
	$(LTLINK) -o $@ slapd-read.o $(LIBS)

slapd-addel: slapd-addel.o $(LDAP_LIBLBER_DEPEND) $(LDAP_LIBLDAP_DEPEND)
	$(LTLINK) -o $@ slapd-addel.o $(LIBS)

bdb2-local:	build-tools FORCE
	@if test "$(BUILD_BDB2)" = "yes" ; then \
		$(LN_S) $(srcdir)/data . ; \
		echo "Initiating LDAP tests..." ; \
		$(MKDIR) test-db test-repl ; \
		$(srcdir)/scripts/all $(srcdir) bdb2 ; \
	else \
		echo "run configure with --enable-bdb2" ; \
	fi

all-local:	build-tools FORCE
	@-$(LN_S) $(srcdir)/data .
	@echo "Initiating LDAP tests..."; \
	$(MKDIR) test-db test-repl ; \
	$(srcdir)/scripts/all $(srcdir) ldbm

clean-local:	FORCE
	$(RM) test-db/[!C]* test-repl/[!C]* *core
	$(RM) $(PROGRAMS)
	$(RM) *.o

veryclean-local: FORCE
	@-$(RM) data
	$(RM) -r test-db test-repl
	$(RM) $(PROGRAMS)
	$(RM) *.o

