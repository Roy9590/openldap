#!/bin/sh

# disable LDAP initialization
LDAPNOINIT=true; export LDAPNOINIT

echo ">>>>> Executing all LDAP tests..."

if [ $# -eq 0 ]; then
	SRCDIR="."
else
	SRCDIR=$1; shift
fi
echo ">>>>> Test Directory: $SRCDIR"

if [ $# -eq 1 ]; then
	BDB2=$1; shift
	if [ "$BDB2" == "ldbm" ]; then
		echo ">>>>> LDBM mode"
	else
		echo ">>>>> BDB2 mode"
	fi
fi

for CMD in $SRCDIR/scripts/test*; do
	echo ">>>>> Starting `basename $CMD` ..."
	$CMD $SRCDIR $BDB2
	RC=$?
	if [ $RC -eq 0 ]; then
		echo ">>>>> $CMD completed OK."
	else
		echo ">>>>> $CMD failed (exit $RC)"
		exit $RC
	fi
	echo ">>>>> waiting 5 seconds for things to exit"
	sleep 5
	echo
done
